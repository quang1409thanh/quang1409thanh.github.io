<!DOCTYPE html>
<html>
  <head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  </head>
  <body>
  </br>
  <div class="container" id="app">
  
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal"><i class="bi bi-person-plus"></i></button>
  
  <div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addItemModalLabel">Add new item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form v-on:submit.prevent="submitForm()">
            <div class="mb-3">
              <label for="name">Name:</label>
              <input type="text" id="name" class="form-control" v-model="name">
            </div>
            <div class="mb-3">
              <label for="description">Description:</label>
              <input type="text" id="description" class="form-control" v-model="description">
            </div>
            <div class="d-grid gap-2 col-2 mx-auto">
            <button type="submit" class="btn btn-primary">Save</button>
            </div>
          </form>
        </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="updateItemModal" tabindex="-1" aria-labelledby="updateItemModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateItemModal">Update item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form v-on:submit.prevent="updateForm()">
            <div class="mb-3">
              <label for="name">Name:</label>
              <input type="text" id="editname" class="form-control" v-model="editname">
            </div>
            <div class="mb-3">
              <label for="description">Description:</label>
              <input type="text" id="editdescription" class="form-control" v-model="editdescription">
            </div>
            <div class="d-grid gap-2 col-2 mx-auto">
            <button type="submit" class="btn btn-primary">Update</button>
            </div>
          </form>
        </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="deleteItemModal" tabindex="-1" aria-labelledby="deleteItemModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteItemModalLabel">Confirm deletion</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Please enter your password to confirm deletion:</p>
            <input type="password" class="form-control" v-model="password">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" @click="deleteItem()">Delete</button>
          </div>
        </div>
      </div>
    </div>
    

  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Description</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="item in items" :key="item.id">
        <td v-text="item.id"></td>
        <td v-text="item.name"></td>
        <td v-text="item.description"></td>
        <td>

          <button type="button" id="delete-btn" class="btn btn-danger btn-sm" @click="showDeleteModal(item.id)" data-bs-toggle="modal" data-bs-target="#deleteItemModal"><i class="bi bi-trash3"></i></button>
          <button type="button" class="btn btn-warning btn-sm" @click="selectRow(item.id)" data-bs-toggle="modal" data-bs-target="#updateItemModal"><i class="bi bi-pencil"></i></button>

        </td>
      </tr>
    </tbody>
  </table>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>

<script type="text/javascript">
  new Vue({
    el: '#app',
    data: {
      name: '',
      description: '',
      editname: '',
      editdescription: '',
      items: [],
      selectedId: null,
      password: ''
    },
    created() {
      this.loadItems();
    },
    methods: {
      loadItems() {
        google.script.run.withSuccessHandler(response => {
          this.items = response;
        }).getItems();
      },
      submitForm() {
        google.script.run.withSuccessHandler(() => {
          this.name = '';
          this.description = '';
          this.loadItems();
          var myModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('addItemModal')).hide();
        }).addItem(this.name, this.description);
      },
      showDeleteModal(id) {
        this.selectedId = id;
      },
      deleteItem() {
        if (this.password === 'salonpas') {
          var myModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('deleteItemModal')).hide();
          google.script.run.withSuccessHandler(() => {
            this.password = '';
            this.loadItems();
          }).deleteItem(this.selectedId);
        }
      },
      selectRow(id) {
        const item = this.items.find(item => item.id === id);
        this.editname = item.name;
        this.editdescription = item.description;
        this.selectedId = id;
      },
      updateForm() {
        google.script.run.withSuccessHandler(() => {
          this.loadItems();
          this.editname = '';
          this.editdescription = '';
          this.selectedId = null;
          var myModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('updateItemModal')).hide();
        }).updateItem(this.selectedId, this.editname, this.editdescription);
      }
    }
  });
</script>

</body>
</html>